### [ CHAPTER 9 ] 코드 리뷰

- 프리커밋 리뷰
    - 코드베이스에 커밋하기 전에 수행하는 코드리뷰
    - 최종목표 : LGTM ( Look Good To Me ) 받기 ⇒ 코드 적용를 합의한다는 의미


- 코드는 부채다
    - 존재만으로 어느 순간 누군가가 유지보수 해야할 대상이 된다.
    - 개발하기에 앞서 꼭 필요한지 살펴야한다. 작성되는 순간 관리 비용이 생겨나기 때문이다.
    - 이상적으로는, 새로운 것을 설계할 때 관련 대화를 먼저 나눠야한다.

      ⇒ 대화를 통해 결정 되었다면, 코드리뷰에서는 기본 결정을 번복하거나 재논의하는 자리여서는 안된다.


- 코드리뷰 측면
    - 정확성/용이성 ( from 팀원 )
        - 작성자의 의도가 코드에서 적절히 수행되는가?
    - 코드베이스 소유자의 승인 ( from 테크리더 )
    - 가독성 승인 ( from 가독성 인증자 )

  ⇒ 각 역할의 사람들이 각기 다른 측면의 리뷰애 집중할 수 있다.


- 코드의 소유권
    - Repository의 규모가 작다면, 누구나 전문가가 될 수 있고 파급력도 적을 수 있다.
    - 하지만 규모가 커질수록 점점 지탱하기 어려워진다.
    - ( 개인적인 생각 )
        - 책에서처럼 각 측면을 관리할 관리자를 나누는 것도 방법이지만, MSA 등을 활용하여 범위를 쪼개는 것도 하나의 방법일 수 있겠다.
        - 관리자를 나누는 것 ⇒ 회사 전체의 결이 맞춰질 수 있지만, 그 결을 맞추는 비용이 클 것 같다.
        - 범위를 쪼개기 ⇒ 각 단위 별로 독립적이라는 것이 양날의 검일수도 있을 것 같다.


- 코드리뷰의 이점
    - 코드 정확성
        - 코드가 의도대로 동작 하는지, 테스트가 갖춰졌는지, 설계는 적절한지, 효율적인지 등등
        - 정확성이 높을수록 테스트, 디버깅 등에 투입되는 시간이 줄어든다.
        - 정적분석/자동화테스트 등을 통해 자동으로 정확성을 검사할 수 있다.
    - 코드 이해 용이성
        - 작성자의 관점에 치우지지 않은 피드백을 제공한다.
        - 이해하기 쉬우면서, 유지보수도 가능한 코드인지 검토하자.
    - 코드 일관성
        - 조직 안에서 이해되고 유지보수 될 수 있도록 일정한 표준을 따라야한다.
    - 심리적, 문화적 이점
        - 코드는 자신의 것이 아니라 협업을 통해 만들어진 조직의 공동 소유물임을 인식시켜준다.
        - 감정을 배제하고 비판적으로 검토할 수 있는 과정이다.
    - 지식 공유
        - 제안, 신기술 소개, 조언 등을 통해 도메인 지식이 전파된다.


- 모범적인 코드리뷰
    - 공손하고 전문가답게
        - 작성자가 선택한 방식을 존중하고, 결함이 있을 때만 대안을 제시해야한다.
        - 다른 대안 중 특별히 더 우수한 게 없다면 작성자의 취향을 존중해야한다.
        - 리뷰어가 단 댓글은 모두 할일로 취급하여 모든 댓글에 대해 최소한의 고민은 해야한다.
    - 작게 변경하기
        - 구글은 큰 변경에 대해 거부할 권한도 있다.
        - 변경량이 적다면 버그 발생 시 살펴볼 코드의 양도 줄어든다.
        - 일반적으로 작은 변경이라하면 코드 200줄 이하를 말한다.
    - 변경 설명 잘쓰기
        - 첫번째 줄을 어떤 종류의 변경인지 파악할 수 있도록 잘 써야한다.
        - 이후에는 구체적으로 무엇을 왜 변경하는지에 대한 자세한 설명이 필요하다.
        - 지금 당장 뿐만 아니라 후대를 위해 현재를 기록하는 역할도 한다.
    - 리뷰어는 최소한으로
        - 리뷰어가 추가될 때 마다 새로운 시각이 추가되며 결국 가치보다 비용이 훨씬 빠르게 증가한다.
        - 수확 체감
            - 생산에 필요한 요소들 중 다른 요소들은 변화하지 않은 상태에서 **한 생산요소가 증가**할때 단위당 **한계 생산량은 줄어 드는** 현상
    - 가능한 자동화하기


- 코드리뷰 유형

  > 각 유형에 따라 어느 측면에 더 집중해야하는지가 다르다.
  >
    - 그린필드 코드리뷰
        - 완전히 새로운 코드 대상!
        - 해당 코드가 오랜 기간 존속될 수 있는지를 평가한다.
        - 설계는 이전 설계 리뷰에서 강도 높게 진행했기에 추가적인 논의를 진행하지 않는다.
        - **설계에 부합했는지 테스트는 진행했는지 등을 확인한다.**
    - 동작 변경 / 개선 / 최적화
        - 삭제 또한 바람직한 변경의 예시이다. 죽은 코드 없애기!
        - 동작 변경 ⇒ 변경된 동작에 맞게 테스트도 변경되었는지 확인한다.
        - 개선 ⇒ 기존 테스트들이 그대로 통과되는지 확인한다.
        - 최적화 ⇒ 성능 테스트 결과를 확인한다.
    - 버그 수정과 롤백
        - 버그 수정/롤백 이외에 다른 변경은 절대 없어야한다.

          ⇒ 리뷰가 많아지는 것은 둘째치고, 테스트를 훨씬 어렵게 만든다.

        - 버그가 존재했다는 것은 기존 테스트가 충분하지 못했을 가능성이 크다.
            - 테스트를 보강하도록 요청하자.
    - 리팩터링과 대규모 변경
