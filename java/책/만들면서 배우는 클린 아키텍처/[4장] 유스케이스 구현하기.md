### [4장] 유스케이스 구현하기

- 유스케이스의 책임

  ![image](https://github.com/ulimy/study/assets/18046394/adea617d-6368-48ef-b3cd-c5f93a659a38)

    1. 입력을 받는다.
        - 인커밍 어댑터로부터 입력을 받는다.
    2. 비즈니스 규칙을 검증한다.
        - 도메인과 이 책임을 공유한다.
        - 이때 입력 유효성 검증은 포함되지 않는다. ( 애플리케이션 계층의 command 책임 )
    3. 모델 상태를 조작한다.
        - 도메인 객체의 상태를 바꾸고 영속성 어댑터를 통해 저장될 수 있도록 한다.
        - 혹은 또다른 아웃고잉 어댑터를 호출할 수 있다.
    4. 출력을 반환한다.
        - 아웃고잉 어댑터에서 온 출력값을 유스케이스를 호출한 어댑터로 반환할 출력객체로 변환한다.


- 입력 유효성 검증
    - 어댑터가 유스케이스에 입력을 전달하기 전에 유효성을 검증한다면?
        - 유즈케이스는 완벽히 검증되었다고 믿을 수 있을까?
        - 유즈케이스는 하나 이상의 어댑터에서 호출될텐데 각 어댑터에 모두 구현되어야하는가?
    - 애플리케이션 계층의 커맨트가 담당하자.


- 빌더패턴을 추천하지 않는다.
    - 새로운 필드가 추가되었을 때 누락될 가능성이 있다.
        - 유효성 검증 로직이 있다해도 런타임에 동작한다.
        - 단위테스트가 없는 경우에도 포착할 수 없다.
    - IDE에서 파라미터명 힌트를 주니 활용해보자!


- 각 유즈케이스 전용 입력모델
    - 비슷한 유즈케이스라 할지라도 다른 입력모델을 사용하자.
    - ex) 등록/수정은 거의 동일한 필드가 필요하지만, Id 값 필수 여부가 다르다.
    - 입력 모델을 분리하면 서로다른 유즈케이스간에 결합도 제거되기 때문에 불필요한 부수효과를 줄인다.


- 비즈니스 규칙 검증하기
    - 입력유효성과 비즈니스 규칙의 차이
        - 비즈니스 규칙은 도메인의 현재 상태에 접근해야한다.
        - 입력유효성 → 구문상의 유효성 검증
        - 비즈니스 규칙 → 의미적인 유효성 검증
        - 이렇게 구분한다면 특정 검증 로직이 어디에 구현되어있는가를 파악할 때, 도메인 상태 접근 필요여부만 알면 된다.
    - 비즈니스 규칙은 도메인 엔티티 안에 구현하자.
    - 만약 도메인 엔티티 안이 여의치 않다면 유즈케이스 코드에서 도메인을 사용하기 전에 구현하자.


- 풍부한 도메인 모델 vs 빈약한 도메인 모델
    - 풍부한 도메인 모델
        - DDD의 철학
        - 최대한 많은 로직을 엔티티 안에 구현한다.
        - 엔티티는 상태를 변경하는 메서드만 제공하고, 비즈니스 규칙에 맞는 유효성 변경만을 허용한다.
        - 유즈케이스는 도메인 모델의 진입점으로 동작한다.
        - ex) 송금하기 기능 → Account의 withdraw(), deposit() 호출
    - 빈약한 도메인 모델
        - 엔티티는 필드, getter, setter만 포함하고 도메인 로직을 가지고있지 않다.
        - 도메인 로직은 유즈케이스에 구현한다.
        - 도메인이 빈약해진 대신 유즈케이스가 풍부해지는 것!

  ⇒ 어느쪽이든 정답은 없다. 필요에 맞게 자유롭게 선택하자.


- 유즈케이스마다 다른 출력 모델
    - 비슷한 유즈케이스라 할지라도 다른 출력모델을 사용하자.
    - 같은 유즈케이스에서 같은 출력 모델을 사용하고, 출력 모델에 새로운 필드가 추가되면?
        - 이 값과관련 없는 다른 유즈케이스에서도 해당 값을 반환해야한다.
    - 만약 어떤 것을 출력해야할지 애매하다면 가능한 적게 반환하자.
    - 도메인 엔티티를 출력모델로 사용하지 말자.
        - 도메인 엔티티를 변경할 수 있는 경로가 늘어나게 하지 말자.


- 읽기 전용 유즈케이스
    - 애플리케이션 관점에서 읽기란 그저 쿼리 수행이다.
    - 쿼리를 위한 인커밍 전용 포트를 만들어 명령과 쿼리를 분리할 수 있다.
