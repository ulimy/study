### DB 락

- DB 락의 필요성

  > 2개 이상의 세션이 같은 데이터를 바라보고 있는 경우
  >
    - 세션A 트랜잭션 시작, 커밋 수행 X
    - 세션 B 트랜잭션 시작, 세션 A가 바라보고 있는 데이터를 수정
    - 세션 A가 롤백되는 경우 세션 B가 수정한 데이터는 그대로 유실된다.

  ⇒ 트랜잭션의 원자성이 깨지는 것!


- DB 락을 이용한 해결방법
    - 보다 빠르게 접근한 세션이 데이터 변경을 시도할 때 DB 락을 획득한다.
    - 락을 획득한 세션만 데이터를 변경할 수 있다!
    - 데이터 변경을 마쳤다면 트랜잭션을 커밋한다. ( == DB 락을 반환한다 )


- select for update

  > 데이터를 조회할 때 DB 락 획득
  >
    - 대부분의 조회에는 락을 획득하지 않고 바로 데이터를 조회할 수 있지만, 락을 강제로 획득해야할 때 해당 구문을 사용한다.
    - 트랜잭션 종료 시점까지 다른 트랜잭션에서 해당 데이터를 변경하지 못하도록 강제로 막기 위해 활용한다.

      ex) 데이터 A의 금액을 조회하여, 복잡한 계산을 통해 계산 결과 저장해야하는 경우

        ```sql
         select * from A for update;
        ```

    - 락이 획득되었기 때문에 다른 트랜잭션에서 데이터 변경 불가능. 조회는 가능.
